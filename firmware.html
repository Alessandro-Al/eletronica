<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">

  <title>Firmware</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
    }

    header {
      background: #003366;
      color: #fff;
      padding: 16px;
    }

    h2 {
      margin: 20px auto 10px auto;
      /* Centraliza horizontalmente e d√° espa√ßo em cima/baixo */
      text-align: center;
      /* Centraliza o texto dentro do h2 */
      font-size: 36px;
      /* Aumenta o tamanho do texto */
      background-color: #359cb6;
      /* Mant√©m a cor de destaque */
      color: #fff;
      /* Texto branco para melhor contraste */
      padding: 12px 24px;
      /* Mais espa√ßo interno */
      border-radius: 10px;
      /* Cantos arredondados mais suaves */
      /*  display: table;               /* Mant√©m a barra do tamanho do conte√∫do */
      font-weight: bold;
      /* Negrito */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      /* Sombra mais vis√≠vel */
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid #ccc;
      margin-bottom: 20px;
    }


    .tab {
      padding: 10px 16px;
      cursor: pointer;
      border: none;
      background: #eee;
      margin-right: 4px;
      border-radius: 4px 4px 0 0;
      transition: all 0.2s ease;
    }

    .tab:not(.active):hover {
      background: #cfe3ff;
      transform: translateY(-2px);
    }

    /* .tab {
      padding: 10px 16px;
      cursor: pointer;
      border: none;
      background: #eee;
      margin-right: 4px;
      border-radius: 4px 4px 0 0;
    }

    .tab:hover {
      background: #d0e7ff;
    } */

    .tab.active {
      background: #676caf;
      border: none;
      /* remove borda padr√£o */
      border-bottom: 2px solid #003366;
      /* mant√©m s√≥ a linha inferior */
      font-weight: bold;
      border-radius: 4px 4px 0 0;
      /* mant√™m cantos arredondados s√≥ em cima */
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    ul,
    ol {
      padding-bottom: 20px;
    }

    b {
      font-weight: bold;
      /* J√° √© bold por <b>, mas refor√ßa */
      color: #3611da;
      /* Pode deixar mais escuro para contraste */
    }

    .note {
      font-style: italic;
      font-size: 0.85em;
      color: #3a25ac;
      margin-left: 12px;
      margin-top: 2px;
    }

    #board-view {
      text-align: center;
      margin-bottom: 20px;
    }

    #board-img {
      max-width: 100%;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .board-container {
      display: flex;
      gap: 40px;
      align-items: flex-start;
      margin-top: 20px;
    }

    .board-description {
      max-width: 800px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      line-height: 1;
    }

    .board-description p {
      margin: 8px 0;
    }

    .board-description h3 {
      margin-top: 0;
      color: #2c3e50;
    }
  </style>
</head>

<body>
  <header>
    <h2 id="pageTitle"></h2>
    <h1 id="fw-title"></h1>
    <p id="fw-subtitle"></p>
  </header>


  <div class="board-container">
    <div id="board-view">
      <img id="board-img" src="" alt="Placa">
    </div>
    <div class="board-description" id="board-description">
    </div>
  </div>
  <div class="tabs" id="tabs"></div>
  <div id="tab-contents"></div>



  <script>
    const TABS = [
      { id: "visao", label: "Vis√£o Geral", ordered: false },
      { id: "opcoes", label: "Op√ß√µes", ordered: false },
      { id: "subfw", label: "SUBFW", ordered: false },
      { id: "entradas", label: "Entradas", ordered: true },
      { id: "saidas", label: "Sa√≠das", ordered: true },
      { id: "serial", label: "Serial", ordered: true },
      { id: "portas", label: "Portas", ordered: false },
      { id: "memoria", label: "Mem√≥ria", ordered: false },
      { id: "plc", label: "PLC", ordered: false },
      { id: "observacoes", label: "Observa√ß√µes", ordered: false },
      { id: "instalacao", label: "Instala√ß√£o", ordered: false },
      { id: "configuracao", label: "Configura√ß√£o", ordered: false },
      { id: "diagnostico", label: "Diagn√≥stico", ordered: false },
      { id: "dicas", label: "Dicas", ordered: false }
    ];
    /* ================= FUN√á√ïES ================= */
    // Pega par√¢metro da URL
    function getParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }
    // Carrega o data.js dinamicamente via parÔøΩmetro dir
    (function () {
      const dir = getParam("dir") || "."; // padrÔøΩo ÔøΩ a mesma pasta
      const script = document.createElement("script");
      script.src = `${dir}/data.js`;
      script.onload = () => {
        loadFirmware(); // sÔøΩ carrega o firmware depois do script
      };
      script.onerror = () => {
        document.querySelector('.board-container').innerHTML = "<b>Falha ao carregar data.js</b>";
      };
      document.head.appendChild(script);
    })();
    // Abre aba clicada, segura contra erros
    function openTab(evt, tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      if (evt && evt.currentTarget) {
        evt.currentTarget.classList.add('active');
      }
      const tabContent = document.getElementById(tabId);
      if (tabContent) {
        tabContent.classList.add('active');
      } else {
        console.warn(`Aba '${tabId}' n√£o encontrada no DOM`);
        return;
      }
      if (typeof updateBoardImage === "function") {
        updateBoardImage(tabId);
      }
    }
    // Atualiza imagem da placa conforme aba
    function updateBoardImage(tabId) {
      const fwKey = getParam("fw") || "vp1200";
      const fw = DATA[fwKey];
      const dir = getParam("dir") || "."; // mesmo dir do data.js
      if (!fw || !fw.images) return;
      // pega a imagem da aba, ou a imagem padrÔøΩo "visao"
      let img = fw.images[tabId] || fw.images.visao || "";
      // se a imagem nÔøΩo for URL completa, adiciona o caminho da pasta
      if (img && !img.startsWith("http") && !img.startsWith("/")) {
        img = `${dir}/${img}`;
      }
      document.getElementById("board-img").src = img;
      if (!fw.descricaoPlaca) return;
      const desc = fw.descricaoPlaca;
      const container = document.getElementById("board-description");
      let html = `<h3>${desc.titulo}</h3>`;
      // üîπ Lista vari√°vel de par√¢metros
      html += desc.hardware.map(p =>
        `<p><strong>${p.label}</strong> ${p.valor}</p>`
      ).join("");
      container.innerHTML = html;
    }
    const li = (item) => `<li>${item.label ?? item}${item.title ? `<span class="note">${item.title}</span>` : ""}</li>`;
    // Renderiza listas de forma segura
    function renderSerial(value) {
      if (!Array.isArray(value)) return "";
      return "<ol>" + value.map((s, i) =>
        `<li${i === 0 ? ' value="0"' : ''}>${s.label ?? s}${s.title ? ` <span class="note">${s.title}</span>` : ""}</li>`
      ).join("") + "</ol>";
    }
    function renderList(value, ordered = false) {
      if (!value) return "";
      if (Array.isArray(value)) {
        if (ordered) {
          const tag = "ol";
          return `<${tag}>${value.map(li).join("")}</${tag}>`;
        } else {
          const tag = "ul";
          return `<${tag}>${value.map(li).join("")}</${tag}>`;
          //          return `<${tag}>${value.map(v => `<li>${v.label || v}</li>`).join("")}</${tag}>`;
        }
      }
      if (typeof value === "object") {
        return "<ul>" + Object.entries(value)
          .map(([k, v]) => `<li><b>${k}:</b> ${v}</li>`)
          .join("") + "</ul>";
      }
      return value;
    }
    // Carrega firmware
    function loadFirmware() {
      const fwKey = getParam("fw") || "vp1200";
      const fw = DATA[fwKey];
      if (!fw) {
        document.querySelector('.container').innerHTML = "<b>Firmware n√£o encontrado.</b>";
        return;
      }
      document.getElementById('pageTitle').innerText = `${getParam("name") || ""}`.trim();;
      document.getElementById("fw-title").innerText =
        `${getParam("title") || ""} ${getParam("versao") || ""} ${getParam("desc") || ""}`.trim();
      document.getElementById("fw-subtitle").innerText =
        `${fw.descricao || ""} | ${fw.fw_id || ""}`;
      const tabsContainer = document.getElementById("tabs");
      const contentContainer = document.getElementById("tab-contents");
      contentContainer.innerHTML = "";
      tabsContainer.innerHTML = "";
      TABS.forEach(tab => {
        const value = fw[tab.id];
        const isEmpty =
          value === undefined ||
          value === null ||
          (typeof value === "string" && value.trim() === "") ||
          (Array.isArray(value) && value.length === 0) ||
          (typeof value === "object" && Object.keys(value).length === 0);
        if (isEmpty) return; // üî• N√ÉO CRIA A ABA
        const btn = document.createElement("div");
        btn.className = "tab";
        btn.innerText = tab.label;
        btn.onclick = (e) => openTab(e, tab.id);
        tabsContainer.appendChild(btn);
        const div = document.createElement("div");
        div.id = tab.id;
        div.className = "tab-content";
        if (tab.id === "serial") {
          div.innerHTML = renderSerial(fw[tab.id]);
        } else {
          div.innerHTML = renderList(fw[tab.id], tab.ordered);
        }
        contentContainer.appendChild(div);
      });
      // Atualiza imagem inicial
      updateBoardImage("visao");
      // Abre a primeira aba vis√≠vel
      document.querySelector('.tab:not([style*="none"])')?.click();
    }
  </script>
</body>

</html>